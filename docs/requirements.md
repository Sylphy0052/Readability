# 要件定義書 (Requirements Definition)

## 1. はじめに

本ドキュメントは、Readability (Chrome Extension) の要件を定義するものである。本システムは、指定されたURLからウェブサイトを巡回し、AIを活用して高品質なMarkdownドキュメントを生成することを目的とする。

## 2. ユーザー要件

### 2.1 ターゲットユーザー

* 複数のウェブページ情報をまとめて保存・閲覧したいユーザー
* ウェブ上の技術ドキュメントや記事をMarkdown形式でローカルに保存したいエンジニア・研究者
* オフライン環境でのドキュメント参照を希望するユーザー

### 2.2 利用シーン

* 特定の技術ブログの連載記事を一括ダウンロードする
* マニュアルサイト全体を1つのファイルにまとめて、LLM（大規模言語モデル）のコンテキストとして利用する
* ニュースサイトの特定トピックに関する記事を収集する

## 3. 機能要件

### 3.1 クローリング機能

* **開始点指定**: ユーザーが指定したURL（カレントタブ）を開始点とする。
* **リンク追跡**: ページ内のリンクを解析し、自動的に次のページへ遷移・取得する。
* **深度制御**:
  * ユーザー指定の深度（0〜3）まで再帰的にリンクを辿る機能。
  * 深度0は現在のページのみ、深度1はリンク先1階層まで、とする。
* **スコープ制御**:
  * **同一ドメインモード**: 開始URLと同一オリジンのリンクのみを対象とする。
  * **外部ドメイン（限定）モード**: 本文領域内に含まれるリンクに限り、外部ドメインでも1階層のみ取得を許可する。
* **重複防止**: 既に訪問したURLは再取得しない（訪問済みリストの管理）。
* **ループ防止**: 同一ページへの無限ループを防ぐ仕組みを持つこと。

### 3.2 コンテンツ抽出・整形機能

* **本文抽出**:
  * ナビゲーション、広告、フッターなどの不要な要素を除外し、メインコンテンツのみを抽出する。
  * `Readability.js` 相当のアルゴリズムを利用する。
* **Markdown変換**:
  * HTMLをMarkdown形式に変換する。
  * 見出し、リスト、リンク、画像を適切に変換する。
* **AI整形 (Gemini Nano)**:
  * 抽出したテキストの整形（不自然な改行の削除、コードブロックの修正など）。

### 3.3 AI整形機能

* **自動整形**: Markdown の改行や見出し、コードブロックを整形するオプション。

### 3.4 出力機能

* **単一ファイル出力**: 取得した全コンテンツを1つのMarkdownファイル（.md）として結合する。
* **メタデータ付与**: 各ページの先頭に「元記事タイトル」「URL」を記載する。
* **ダウンロード**: 生成されたファイルをユーザーのローカル環境にダウンロードさせる。

### 3.5 UI/UX機能 (Popup)

* **設定変更**: クロール深度、スコープ、AI機能のON/OFFを設定可能にする。
* **進捗表示**: 現在処理中のURL、完了ページ数/予定数、進捗バーを表示する。
* **操作**: クロールの開始、キャンセルが可能であること。

## 4. 非機能要件

### 4.1 パフォーマンス

* ブラウザの動作を重くしないよう、大量のページ処理はバックグラウンドで行う。
* 並行リクエスト数を制限し（逐次処理推奨）、対象サーバーへの過度な負荷を防ぐ。

### 4.2 プライバシー・セキュリティ

* **ローカル処理**: AI処理（Gemini Nano）は可能な限りローカルで完結させ、外部サーバーへのデータ送信を最小限にする（または行わない）。
* **権限**: 必要最小限の権限（`activeTab`, `scripting`, `downloads` 等）のみを使用する。クロスオリジン通信が必要な場合は `host_permissions` を適切に設定する。

### 4.3 動作環境

* Google Chrome (最新版)
* Gemini Nano が有効化された環境 (AI機能利用時)

## 5. 制約事項

* Chrome Extension Manifest V3 に準拠すること。
* Gemini Nano のコンテキストウィンドウサイズを超える入力に対する分割処理の実装が必要。
* Chrome Web Store の審査基準を満たすこと。
